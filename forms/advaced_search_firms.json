{
    "className": "org.joget.apps.form.model.Form",
    "elements": [
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field23",
                            "label": "",
                            "value": "<style>\n.btn input:focus {\n\n    outline: none!important;\n  \n}\n    #submit{\n        display:none!important;\n    }\n#submitoparent{\n\nbackground-color: #0E6BB2 !important;\n    border: 1px solid #614ac1 !important;\nborder: none !important;\n\nfont-family: \"Epilogue-Bold\" !important;\n\ncolor: white !important;\nfont-style: normal;\npadding: 0;\n}\ninput#submito {\n    font-size: 10px !important;\n    padding: 7px 17px;\n    border: 1px solid #614ac1 !important;\n    \n}\n\n<\/style>\n<div class=\"d-flex align-items-center justify-content-between w-100\">\n   <button type=\"button\" class=\"clear-btn mx-1 px-3 btn-red float-start rounded-2  fs-6  btn  clear-btn epilogue-semiBold\" onclick=\"clear2();\">Clear<\/button>\n  \n       \n    <i id=\"submitoparent\" class=\"form-button btn button btn-blue float-start rounded-2 fs-6 epilogue-semibold waves-input-wrapper waves-effect btn waves-button waves-float\" style=\"color:rgb(255, 255, 255);background:rgba(0, 0, 0, 0)\"><input id=\"submito\" onClick=\"submitForm()\" name=\"submito\" class=\"waves-button-input\" type=\"button\" value=\"Show results\"  style=\"background-color:rgba(0,0,0,0);\"><\/i>\n\n\n\n<\/div>\n\n<script>\nfunction submitForm(){\n     var keywords = \"\";\n                    var industry =\"\";\n                    var location = \"\";\n                    var tags=\"\";\n                    if(FormUtil.getValue(\"keywords\")!=null){\n                        if (tags==\"\")\n                            tags += \"keywords: \" + FormUtil.getValue(\"keywords\");\n                        else\n                            tags += \",keywords: \" + FormUtil.getValue(\"keywords\");\n                    }\n                        \n                    if(FormUtil.getValue(\"industry\")!=null){\n                         if (tags==\"\")\n                            tags += \"industry: \" + FormUtil.getValues(\"industry\");\n                        else\n                            tags += \",industry: \" + FormUtil.getValues(\"industry\");\n                    }    \n                        \n                    if(FormUtil.getValue(\"location\")!=null){\n                         if (tags==\"\")\n                            tags += \"location: \" + FormUtil.getValues(\"location\");\n                        else\n                            tags += \",location: \" + FormUtil.getValues(\"location\");\n                    }\n                    document.getElementById('tags').value=tags;\n                    document.getElementById('submit').click();\n}\nfunction clearFonction() {\n    \n    //keywords\n    document.getElementById('keywords').value='';\n\n    //reperters\n    var deleteRepeter= document.getElementsByClassName('repeater-action-delete')\n    console.log(\"deleteRepeter: \", deleteRepeter);\n    var deleteRepeterLength=deleteRepeter.length;\n    if(deleteRepeterLength>0) {\n        while( deleteRepeterLength != 0) {\n            deleteRepeter[deleteRepeterLength-1].click();\n            deleteRepeterLength--;\n        }\n    }\n    \n    var repetersAddBtn=document.querySelectorAll('.repeater-actions-add');\n    for (var repBtn of repetersAddBtn) {\n        repBtn.style.display='unset';\n    }\n\n    //Slider\n    $(\".ui-state-default:first\").text('0');\n    $(\".ui-state-default\").slice(1).text('35');\n    var v = [0, 35];\n        $(\"#slider_years_experience_years_experience\").slider({\n            range: true,\n            min: 0,\n            max: 35,\n            values: v,\n            slide: function(event, ui) {\n            //return false;\n              if ((ui.values[1] - ui.values[0]) < 2) {\n    \t          return false;\n              }\n              $(\".ui-state-default:first\").text(ui.values[0]);\n              $(\".ui-state-default\").slice(1).text(ui.values[1]);\n              document.getElementById('min_years_exp').value=ui.values[0];\n              document.getElementById('max_years_exp').value=ui.values[1];\n            },\n            create: function(event, ui) {\n                $(\".ui-state-default:first\").text(v[0]);\n                $(\".ui-state-default\").slice(1).text(v[1]);\n                \n            }\n        }).trigger('slide');\n\n    document.getElementById('min_years_exp').value=0;\n    document.getElementById('max_years_exp').value=35;\n\n    //Ajax single selection\n    document.getElementById('job').innerHTML=\"\";\n    document.getElementById('location').innerHTML=\"\";\n    document.getElementById('level_of_education').innerHTML=\"\";\n    document.getElementById('field_of_study').innerHTML=\"\";\n    var ajaxSingle=document.querySelectorAll('.chosen-single');\n    var placeholders=['Job title',\n    'Current location',\n    'Level of education',\n    'Field of study'];\n    var index=0;\n\n    for (var itemSingle of ajaxSingle) {\n        itemSingle.className=\"chosen-single chosen-default\";\n        itemSingle.innerHTML=`<span>${placeholders[index]}<\/span><div><b><\/b><\/div>`;\n        index++;\n    }\n    \n    //Ajax multi selection\n    var ajaxMulti=document.getElementsByClassName('search-choice-close');\n    console.log(ajaxMulti);\n    var ajaxMultiLength=ajaxMulti.length;\n    if(ajaxMultiLength>0) {\n        while( ajaxMultiLength != 0) {\n            ajaxMulti[ajaxMultiLength-1].click();\n            ajaxMultiLength--;\n        }\n    }\n\n}\nfunction clear2(){\n    window.location=\"firms\";\n}\n\n<\/script>\n"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "accor",
                            "label": "",
                            "value": "<style>\n    #save{\n        float:right;\n        display:none;\n    }\n    \n    /* The Modal (background) */\n    .modal {\n      display: none; /* Hidden by default */\n      position: fixed; /* Stay in place */\n      z-index: 1; /* Sit on top */\n      left: 0;\n      top: 0;\n      width: 100%; /* Full width */\n      height: 100%; /* Full height */\n      overflow: auto; /* Enable scroll if needed */\n      background-color: rgb(0,0,0); /* Fallback color */\n      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\n    }\n    \n    /* Modal Content/Box */\n    .modal-content {\n      background-color: #fefefe;\n      margin: 15% auto;/* 15% from the top and centered */\n      padding: 20px;\n      border: 1px solid #888;\n      width: 500px; /* Could be more or less, depending on screen size */\n    }\n    \n    /* The Close Button */\n    .close {\n      color: #aaa;\n      float: right;\n      font-size: 50px;\n      font-weight: bold;\n    }\n    \n    .close:hover,\n    .close:focus {\n      color: black;\n      text-decoration: none;\n      cursor: pointer;\n    }\n    \n    .hr{\n       height:1px;\n       border-width:0;\n       color:gray;\n       background-color:gray \n    }\n<\/style>\n\n      <div class=\"acc\">\n    <div class=\"acc__card\">\n      <div class=\"acc__title template-color epilogue-bold\">Filters<\/div>\n      <div class=\"acc__panel\">\n         <div class=\"oo\"><\/div>\n      <\/div>\n    <\/div>\n \n\n  <\/div>\n<input type=\"button\" value=\"Save\" id=\"save\" disabled/>\n\n<div id=\"myModal\" class=\"modal\">\n\n  <!-- Modal content -->\n  <div class=\"modal-content\">\n    <span class=\"close\">&times;<\/span>\n    <div id=\"modal-msg\">\n         <div>\n                <label>SAVE A SEARCH<\/label>\n                <input id=\"save_title\"  type=\"text\" value=\"\">\n          <\/div>\n    <\/div>\n    <input type=\"button\" value=\"Save\" id=\"confirmSave\"/>\n\n  <\/div>\n<\/div>\n\n\n\n\n\n<script>\nwindow.onload=function(){\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const id = urlParams.get('id')\n    if(id!=null){\n        document.getElementById('save').disabled=false;\n    }\n}\n\n$(document).ready(function(){\n// Get the modal\nvar modal = document.getElementById(\"myModal\");\n\n// Get the <span> element that closes the modal\nvar span = document.getElementsByClassName(\"close\")[0];\n\n// When the user clicks on <span> (x), close the modal\nspan.onclick = function() {\n  modal.style.display = \"none\";\n}\n\n// When the user clicks anywhere outside of the modal, close it\nwindow.onclick = function(event) {\n  if (event.target == modal) {\n    modal.style.display = \"none\";\n  }\n}\n\nvar save = document.getElementById(\"save\");\n\nsave.onclick = function() {\n  modal.style.display = \"block\";\n}\n\nvar confirmSave=document.getElementById(\"confirmSave\");\n\nconfirmSave.onclick = function() {\n    var title=document.getElementById(\"save_title\").value;\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    const idsearch = urlParams.get('id')\n    var uri='E8C088A2B0B84F34AED8BDF7126FDC38?id='+idsearch+'&title='+title;\n           \n    window.location.replace(uri);\n}\n\n})\n\n<\/script>"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.TextField",
                        "properties": {
                            "id": "keywords",
                            "label": "Keyword",
                            "maxlength": "40",
                            "placeholder": "Keyword",
                            "readonly": "",
                            "readonlyLabel": "",
                            "size": "",
                            "storeNumeric": "",
                            "style": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.marketplace.AjaxSelectbox",
                        "properties": {
                            "afterTypeDelay": "300",
                            "allowEmpty": "true",
                            "defaultOptions": "",
                            "displayField": "label",
                            "id": "industry",
                            "idField": "label",
                            "keepTypingMsg": "Continue typing to search",
                            "label": "Industry",
                            "listId": "industry_data_list",
                            "lookingForMsg": "Retrieving results",
                            "minTermLength": "3",
                            "multiple": "",
                            "placeholder": "Industry",
                            "readonly": "",
                            "readonlyLabel": "",
                            "requestParams": [],
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "label",
                            "width": "40%",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.marketplace.AjaxSelectbox",
                        "properties": {
                            "afterTypeDelay": "300",
                            "allowEmpty": "true",
                            "defaultOptions": "",
                            "displayField": "label",
                            "id": "speciality",
                            "idField": "label",
                            "keepTypingMsg": "Continue typing to search",
                            "label": "Speciality",
                            "listId": "specialities_list_data",
                            "lookingForMsg": "Retrieving results",
                            "minTermLength": "3",
                            "multiple": "true",
                            "placeholder": "Speciality",
                            "readonly": "",
                            "readonlyLabel": "",
                            "requestParams": [],
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "label",
                            "width": "40%",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field18",
                            "label": "",
                            "value": "\r\n\t<style>\r\n\t\r\n        .ui-slider { position: relative; text-align: left; }\r\n        .ui-slider .ui-slider-handle { position: absolute; z-index: 2; width: 1.2em; height: 1.2em; cursor: default; }\r\n        .ui-slider .ui-slider-range { position: absolute; z-index: 1; font-size: .7em; display: block; border: 0; background-position: 0 0; }\r\n        \r\n        .ui-slider-horizontal { height: .8em; }\r\n        .ui-slider-horizontal .ui-slider-handle { top: -.3em; margin-left: -.6em; }\r\n        .ui-slider-horizontal .ui-slider-range { top: 0; height: 100%; }\r\n        .ui-slider-horizontal .ui-slider-range-min { left: 0; }\r\n        .ui-slider-horizontal .ui-slider-range-max { right: 0; }\r\n        \r\n        .ui-slider-vertical { width: .8em; height: 100px; }\r\n        .ui-slider-vertical .ui-slider-handle { left: -.3em; margin-left: 0; margin-bottom: -.6em; }\r\n        .ui-slider-vertical .ui-slider-range { left: 0; width: 100%; }\r\n        .ui-slider-vertical .ui-slider-range-min { bottom: 0; }\r\n        .ui-slider-vertical .ui-slider-range-max { top: 0; }\r\n        .ui-spinner { position:relative; display: inline-block; overflow: hidden; padding: 0; vertical-align: middle; }\r\n        .ui-spinner-input { border: none; background: none; padding: 0; margin: .2em 0; vertical-align: middle; margin-left: .4em; margin-right: 22px; }\r\n        .ui-spinner-button { width: 16px; height: 50%; font-size: .5em; padding: 0; margin: 0; text-align: center; position: absolute; cursor: default; display: block; overflow: hidden; right: 0; }\r\n        .ui-spinner a.ui-spinner-button { border-top: none; border-bottom: none; border-right: none; } /* more specificity required here to overide default borders */\r\n        .ui-spinner .ui-icon { position: absolute; margin-top: -8px; top: 50%; left: 0; } /* vertical centre icon */\r\n        .ui-spinner-up { top: 0; }\r\n        .ui-spinner-down { bottom: 0; }\r\n                /*.years_experience .ui-slider {*/\r\n                /*\tmargin-top: 20px;*/\r\n                /*\theight: 7px;*/\r\n                /*\tposition: relative;*/\r\n                /*\tborder: none;*/\r\n                /*\tbackground: rgba(116, 183, 207, 0.6);*/\r\n                /*}*/\r\n            \t.years_experience .ui-slider {\r\n            \t\t\tmargin-top: 20px;\r\n            \t\t\theight: 3px;\r\n            \t\t\tposition: relative;\r\n            \t\t\tborder: none;\r\n            \t\t\tbackground: #614ac133;\r\n            \t\t}\r\n            \t\t\r\n            \t\ta.ui-slider-handle:hover{\r\n            \t\t    cursor:pointer;\r\n            \t\t    \tbackground: #ffffff !important;\r\n                       border: 2px solid #0E6BB2 !important;\r\n            \t\t}\r\n            \t\t\ta.ui-slider-handle{\r\n            \t\t    text-decoration:none;\r\n            \t\t}\r\n            \t\t.ui-state-hover,.ui-state-focus,.ui-slider-handle.ui-state-default.ui-corner-all:hover{\r\n            \t\t  \tbackground: #614ac1 !important;\r\n                        border: 2px solid #614ac1 !important;\r\n                        top: -10px;\r\n                        border-radius: 25px !important;\r\n                        outline: none;\r\n                        position: absolute;\r\n                        font-family: \"Epilogue-Medium\" !important;  \r\n            \t\t}\r\n            \t\t.years_experience .ui-state-default, .years_experience .ui-widget-content .ui-state-default, .years_experience .ui-widget-header .ui-state-default {\r\n            \t\t\tbackground: #ffffff;\r\n                        border: 2px solid #614ac1;\r\n                        top: -10px;\r\n                        border-radius: 25px;\r\n                        outline: none;\r\n                        position: absolute;\r\n                        font-family: \"Epilogue-Medium\" !important;\r\n                \t}\r\n            \t\t.years_experience .ui-slider-horizontal .ui-slider-range {\r\n            \t\t\tbackground: #614ac1 !important;\r\n            \t\t}\r\n                .years_experience #labelHolder {\r\n                    height: 7px;\r\n                    position: relative;\r\n                    border: none;\r\n                }\r\n                .years_experience span {\r\n                  position: absolute;\r\n                  width: 1.2em;\r\n                  height: 1.2em;\r\n                  margin-left: -.6em;\r\n                  text-align: center;\r\n                }\r\n                .ui-slider .ui-slider-handle {\r\n            position: absolute;\r\n            z-index: 2;\r\n            width: 23px;\r\n            height: 23px;\r\n            cursor: default;\r\n            line-height: 23px;\r\n            text-align: center;\r\n        }\r\n            .years_experience .ui-widget-content {\r\n        \r\n            border-radius: 1.2rem !important;\r\n        }\r\n        /******************************/\r\n        .ui-widget-content {\r\n            padding: 1px;\r\n        }\r\n        .years_experience .ui-state-hover, .years_experience .ui-widget-content .ui-state-hover,\r\n        .years_experience .ui-widget-header .ui-state-hover, .years_experience .ui-state-focus,\r\n        .years_experience .ui-widget-content .ui-state-focus, .years_experience .ui-widget-header .ui-state-focus {\r\n            background: #ffffff !important;\r\n            border: 2px solid #614ac1 !important;\r\n             border-radius: 25px !important;\r\n            \r\n        }\r\n            <\/style>\r\n        <script src=\"https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.2/jquery-ui.js\"><\/script>\r\n        \r\n        <label style=\"font-weight:bold\" class=\"w-100\">Company size<\/label><br />\r\n        <div class=\"template-color epilogue-semiBold mt-4\">\r\n        <span id=\"id-min-years\"><\/span> - \r\n        <span id=\"id-max-years\"><\/span>\r\n        <\/div>\r\n        <div class=\"years_experience\">\r\n        \r\n        <div id=\"slider_years_experience_years_experience\"><\/div>\r\n        <\/div>\r\n        <br />\r\n        <script>\r\n        \r\n        $(function () {\r\n             var v = [ 0,10001];\r\n            $(\"#slider_years_experience_years_experience\").slider({\r\n                range: true,\r\n                min: 0,\r\n                max: 10001,\r\n                values: v,\r\n                slide: function(event, ui) {\r\n                //return false;\r\n                  if ((ui.values[1] - ui.values[0]) < 2) {\r\n                      return false;\r\n                  }\r\n              \r\n                       \r\n                 document.getElementById('min_num_of_emp').value=ui.values[0];\r\n                 document.getElementById('max_num_of_emp').value=ui.values[1];\r\n                 document.getElementById('id-min-years').innerHTML=ui.values[0];\r\n                 document.getElementById('id-max-years').innerHTML=ui.values[1];\r\n            \r\n                },\r\n                create: function(event, ui) {\r\n                    $(\"#id-min-years\").html(v[0]);\r\n                    $(\"#id-max-years\").html(v[1]);     \r\n                }\r\n            }).trigger('slide');\r\n        });\r\n        $( document ).ready(function() {\r\n            min=document.getElementById('min_num_of_emp').value;\r\n            max=document.getElementById('max_num_of_emp').value;\r\n            mins=100/10001*min;\r\n            maxs=100/10001*max;\r\n            \r\n                 \r\n                 document.getElementById('id-min-years').innerHTML=min;\r\n                 document.getElementById('id-max-years').innerHTML=max;\r\n                 \r\n                \r\n            document.getElementsByClassName('ui-slider-range ui-widget-header')[0].setAttribute(\"style\",`left: ${mins}%; width: ${maxs-mins}%;`);\r\n            document.getElementsByClassName('ui-slider-handle ui-state-default ui-corner-all')[0].setAttribute(\"style\",`left: ${mins}%;`);\r\n            document.getElementsByClassName('ui-slider-handle ui-state-default ui-corner-all')[1].setAttribute(\"style\",`left: ${maxs}%;`);\r\n           // $(\"#slider_years_experience_years_experience *\").parent.parent.parent.attr(\"disabled\", \"disabled\").off('click');\r\n        \r\n        });\r\n        \r\n        \r\n        <\/script>\r\n        "
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CheckBox",
                        "properties": {
                            "controlField": "",
                            "id": "actively_hiring",
                            "label": "Actively Hiring",
                            "options": [{
                                "grouping": "",
                                "label": "Yes",
                                "value": "yes"
                            }],
                            "optionsBinder": {
                                "className": "",
                                "properties": {}
                            },
                            "readonly": "",
                            "readonlyLabel": "",
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "yes",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.marketplace.AjaxSelectbox",
                        "properties": {
                            "afterTypeDelay": "300",
                            "allowEmpty": "true",
                            "defaultOptions": "",
                            "displayField": "label",
                            "id": "location",
                            "idField": "label",
                            "keepTypingMsg": "Continue typing to search",
                            "label": "Location",
                            "listId": "listlocationdata",
                            "lookingForMsg": "Retrieving results",
                            "minTermLength": "3",
                            "multiple": "true",
                            "placeholder": "Location",
                            "readonly": "",
                            "readonlyLabel": "",
                            "requestParams": [],
                            "validator": {
                                "className": "",
                                "properties": {}
                            },
                            "value": "label",
                            "width": "25%",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "result",
                            "useDefaultWhenEmpty": "true",
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "status",
                            "useDefaultWhenEmpty": "",
                            "value": "active",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "saved",
                            "useDefaultWhenEmpty": "",
                            "value": "false",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "saved_firms",
                            "useDefaultWhenEmpty": "true",
                            "value": "",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "min_num_of_emp",
                            "useDefaultWhenEmpty": "true",
                            "value": "0",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "max_num_of_emp",
                            "useDefaultWhenEmpty": "true",
                            "value": "10001",
                            "workflowVariable": ""
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.HiddenField",
                        "properties": {
                            "id": "tags",
                            "useDefaultWhenEmpty": "",
                            "value": "",
                            "workflowVariable": ""
                        }
                    }
                ],
                "properties": {
                    "customWidth": "",
                    "horizontal": "",
                    "label": "",
                    "width": "100%"
                }
            }],
            "properties": {
                "comment": "",
                "id": "section_filter",
                "join": "",
                "label": "",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionHidden": "",
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        },
        {
            "className": "org.joget.apps.form.model.Section",
            "elements": [{
                "className": "org.joget.apps.form.model.Column",
                "elements": [
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "field22",
                            "label": "",
                            "value": "<style>\r\n/* The Modal (background) */\r\n#titleSearchError{\r\n    margin-bottom:5px;\r\n}\r\n    .modal {\r\n      display: none; /* Hidden by default */\r\n      position: fixed; /* Stay in place */\r\n      z-index: 999; /* Sit on top */\r\n      left: 0;\r\n      top: 0;\r\n      width: 100%; /* Full width */\r\n      height: 100%; /* Full height */\r\n      overflow: auto; /* Enable scroll if needed */\r\n      background-color: rgb(0,0,0); /* Fallback color */\r\n      background-color: rgba(0,0,0,0.4); /* Black w/ opacity */\r\n    }\r\n    \r\n  .modal-content {\r\n    background-color: #ffffff;\r\n    margin: 15% auto;\r\n    padding: 0;\r\n    border: 1px solid #888;\r\n    width: 500px;\r\n    display: block;\r\n}\r\n    \r\n #myModal-advancedSearch .close,\r\n  #myModal-Error .close{\r\n    color: #ffffff !important;\r\n    float: right;\r\n    font-weight: 500;\r\n    opacity: 1;\r\n    position: absolute;\r\n    right: -11px;\r\n    top: -10px;\r\n    width: 25px !important;\r\n    height: 25px !important;\r\n    line-height: 24px !important;\r\n    text-align: center;\r\n    font-size: 19px;\r\n    border-radius: 50%;\r\n    border: 0 !important;\r\n    box-shadow: rgb(100 100 111 / 20%) 0px 7px 29px 0px;\r\n    background: #614ac1 !important;\r\n    text-shadow: none;\r\n}\r\n    .close:hover,\r\n    .close:focus {\r\n      color: #0E6BB2;\r\n      text-decoration: none;\r\n      cursor: pointer;\r\n    }\r\n    .modal-save .btn.waves-input-wrapper {\r\n    color: #ffffff !important;\r\n    background-color: #614ac1 !important;\r\n}\r\n<\/style>\r\n\r\n<div class=\"col bg-white border  p-3 mb-4 d-sm-flex d-md-flex justify-content-between align-items-center rounded-4\">\r\n\r\n\r\n  <h3 class=\"epilogue-bold template-color  \"  style=\"margin: 0;\">About : <span id=\"total_result\" style=\"size:18px\">0<\/span> results<\/h3>\r\n\r\n  <div class=\"d-flex justify-content-end align-items-center\">\r\n    <span class=\"epilogue-regular\">Sort By : <\/span>\r\n    <select class=\"border-none epilogue-medium pe-5\" style=\"width: auto;\" id='sortOption'>\r\n      <option value=\"mostRelevant\">Most relevant<\/option>\r\n      <option value=\"locationAZ\">Location A-Z<\/option>\r\n    <\/select>\r\n    <button class=\" mx-1 px-3 btn-blue float-start rounded-2  fs-6 epilogue-bold  btn_export\" disabled>Export<\/button>\r\n    <button type=\"button\" id=\"SaveAdvs\" class=\" mx-1 px-3 btn-blue float-start rounded-2  fs-6 epilogue-bold\" onclick=\"saveSearch()\" disabled>Save<\/button>\r\n    <button disabled type=\"button\" id=\"save_value\" name=\"save_value\" value=\"Save\" class=\" mx-1 px-3 btn-blue float-start rounded-2  fs-6 epilogue-bold\">Add to campaign<\/button>\r\n\r\n  <\/div>\r\n<\/div>\r\n\r\n<div id=\"myModal-advancedSearch\" class=\"modal\">\r\n  <!-- Modal content -->\r\n  <div class=\"modal-content modal-save\">\r\n    <span class=\"close close-modal\">&times;<\/span>\r\n      <h4 class=\"template-color text-center p-3 \" style=\"background-color:#F7F8FA;\">Save a search<\/h4>\r\n    <div id=\"modal-msg text-center  p-3\">\r\n         <div class=\"mx-4\">\r\n            <label class=\"color-blue-1 p-2 text-center w-100 epilogue-semiBold\">Enter search title<\/label>\r\n                   <span class=\"form-error-message\" id=\"titleSearchError\">Field mandatory<\/span>\r\n            <input id=\"save_title_advancedSearch\" class=\"template-color \" placeholder=\"Keyword\" type=\"text\" value=\"\" maxlength=\"40\">\r\n        <\/div>\r\n    <\/div>\r\n    <div class=\" m-3 text-center \">\r\n        <button type=\"button\" class=\"template-color close-modal close-modal-btn text-center ml-2 rounded-8 btn-border   epilogue-semibold\" >Cancel<\/button>\r\n        <input type=\"button\" class=\"bg-template-color rounded-8    epilogue-semiBold\" onClick=\"confirmSaveSearch\" value=\"Save\" id=\"confirmSaveSearch\"/>\r\n    <\/div>\r\n\r\n  <\/div>\r\n<\/div>\r\n\r\n<script>\r\n     // Get the modal\r\n        var modal2 = document.getElementById(\"myModal-advancedSearch\");\r\n        \r\n       \r\n         // Get the <span> element that closes the modal\r\n        var span = document.getElementsByClassName(\"close-modal\")[0];\r\n        \r\n      \r\n        // When the user clicks on <span> (x), close the modal\r\n        span.onclick = function() {\r\n          modal2.style.display = \"none\";\r\n              document.getElementById(\"titleSearchError\").style.display=\"none\";\r\n        }\r\n           // Get the <span> element that closes the modal\r\n        var span1 = document.getElementsByClassName(\"close-modal\")[1];\r\n        \r\n      \r\n        // When the user clicks on <span> (x), close the modal\r\n        span1.onclick = function() {\r\n          modal2.style.display = \"none\";\r\n              document.getElementById(\"titleSearchError\").style.display=\"none\";\r\n        }\r\n        function saveSearch(){\r\n        modal2.style.display = \"block\";\r\n        window.addEventListener(\"click\", function(e){ \r\n                if (e.target == modal2) {\r\n                        modal2.style.display = \"none\";\r\n                            document.getElementById(\"titleSearchError\").style.display=\"none\";\r\n                  }\r\n            });\r\n        }\r\n        \r\n \r\n   \r\n        confirmSaveSearch.onclick = function() {\r\n            var title=document.getElementById(\"save_title_advancedSearch\").value;\r\n            var total_result=document.getElementById(\"saved_firms\").value;\r\n            const queryString = window.location.search;\r\n            const urlParams = new URLSearchParams(queryString);\r\n            const search = urlParams.get('id');\r\n            console.log(\"Title: \",title,\" total: \",total_result);\r\n            if(title!==''){\r\n            \r\n                    parent.window.location.replace('savedFirmsSearch?id='+search+'&title='+title+\"&total_result=\"+total_result);\r\n            }else{\r\n         \r\n                document.getElementById(\"titleSearchError\").style.display=\"block\";\r\n                \r\n                   \r\n               \r\n            }\r\n            \r\n        }\r\n<\/script>"
                        }
                    },
                    {
                        "className": "org.joget.apps.form.lib.CustomHTML",
                        "properties": {
                            "autoPopulate": "",
                            "id": "show_results",
                            "label": "",
                            "value": "<script src=\"https://cdnjs.cloudflare.com/ajax/libs/list.js/1.5.0/list.min.js\"><\/script>\n\n\n<script type=\"text/\njavascript\" src=\"/jw/js/chosen/chosen.jquery.js\"><\/script>\n\n<script type=\"text/javascript\" src=\"/jw/plugin/org.joget.marketplace.AjaxSelectbox/js/jquery.ajaxselect.js\"><\/script>\n\n<link rel=\"stylesheet\" type=\"text/css\" href=\"/jw/js/chosen/chosen.css\">\n\n<style>\n    .blockUI,\n    .blockOverlay {\n        display: none !important;\n    }\n\n    * {\n        box-sizing: border-box;\n    }\n\n    #bookmark-toggle {\n        font-size: 25px;\n        user-select: none;\n    }\n\n    .repeater-actions-add {\n        float: left;\n        z-index: 0;\n    }\n\n    .container {\n        border-radius: 5px;\n        overflow: hidden;\n        /*width: 1100px;*/\n    }\n\n    .header {\n        color: black;\n        padding: 5px 20px;\n        width: 1100px;\n    }\n\n    .title {\n        margin: 0;\n    }\n\n    .subtitle {\n        display: inline-block;\n        margin: 5px 0 20px;\n        /*opacity: 0.8;*/\n    }\n\n    .users-list {\n        list-style-type: none;\n        margin: 0;\n        width: 100%;\n        padding: 0px;\n        box-sizing: content-box;\n    }\n\n    .users-list li {\n        margin-bottom: 10px;\n    }\n\n    /*.users-list li:not(:last-of-type) {*/\n\n    /*\\tborder-bottom: 1px solid #eee;*/\n\n    /*}*/\n\n    .users-list li.hide {\n        display: none;\n    }\n\n    .users-list li img {\n        border-radius: 50%;\n        object-fit: cover;\n        height: 100px;\n        width: 100px;\n        margin-bottom: 35px;\n    }\n\n    .user-info {\n        margin-left: 10px;\n        width: 100%;\n        position: relative;\n    }\n\n    .user-info h4 {\n        margin: 0 0 10px;\n    }\n\n    .user-info p {\n        font-size: 12px;\n    }\n\n    .tags {\n        list-style: none;\n        margin: 0;\n        overflow: hidden;\n        padding: 0;\n    }\n\n    .tags li {\n        float: left;\n    }\n\n    .tag {\n        background: #FFBEA7;\n        border-radius: 15px !important;\n        color: #393939;\n        display: inline-block;\n        height: 26px;\n        line-height: 26px;\n        padding: 0 20px 0 23px;\n        position: relative;\n        margin: 0 10px 10px 0;\n        text-decoration: none;\n        overflow: hidden;\n    }\n\n    .switch {\n        position: relative;\n        display: inline-block;\n        width: 60px;\n        height: 34px;\n    }\n\n    .switch input {\n        display: none;\n    }\n\n    .slider {\n        position: absolute;\n        cursor: pointer;\n        top: 0;\n        left: 0;\n        right: 0;\n        bottom: 0;\n        background-color: #ccc;\n        -webkit-transition: .4s;\n        transition: .4s;\n    }\n\n    .slider:before {\n        position: absolute;\n        content: \"\";\n        height: 26px;\n        width: 26px;\n        left: 4px;\n        bottom: 4px;\n        background-color: white;\n        -webkit-transition: .4s;\n        transition: .4s;\n    }\n\n    input:checked+.slider {\n        background-color: #2196F3;\n    }\n\n    input:focus+.slider {\n        box-shadow: 0 0 1px #2196F3;\n    }\n\n    input:checked+.slider:before {\n        -webkit-transform: translateX(26px);\n        -ms-transform: translateX(26px);\n        transform: translateX(26px);\n    }\n\n    /* Rounded sliders */\n\n    .slider.round {\n        border-radius: 34px;\n    }\n\n    .slider.round:before {\n        border-radius: 50%;\n    }\n\n    .pagination li {\n        display: inline-block;\n        padding: 5px;\n    }\n\n    .pagination li a {\n        font-weight: 400;\n        padding: 0;\n        width: 35px;\n        height: 35px;\n        line-height: 33px !important;\n        text-align: center;\n        position: relative;\n        cursor: pointer;\n        display: inline-block;\n        z-index: 3;\n        border-radius: 3px !important;\n        margin-left: 5px;\n    }\n\n    .nav-pagination {\n        display: flex;\n        align-items: center;\n        justify-content: center;\n    }\n\n    .nav-pagination [class^=\"btn\"] {\n        padding: 8px;\n        color: #337ab7;\n        margin: 0 3px;\n    }\n<\/style>\n\n\n<div id=\"myModal-Error\" class=\"modal\">\n    <!-- Modal content -->\n\n    <div class=\"modal-content modal-save\\\n    \">\n        <span class=\"close close-modal\">&times;<\/span>\n        <h4 class=\"template-color text-center p-3 \" style=\"background-color:#F7F8FA;\"><\/h4>\n\n        <div id=\"modal-msg text-center p-3\\\n    \">\n\n            <div class=\"mx-4\">\n                <label class=\"color-blue-1 p-2 text-center w-100 epilogue-semiBold\"><\/label>\n\n                <!--<input id=\"filter-error-msg\" class=\"template-color \" placeholder=\"\" type=\"text\" value=\"You must at least fill one filter !\" disabled>-->\n\n\n            <\/div>\n\n\n        <\/div>\n\n        <div class=\" m-3 text-center \">\n\n            <button type=\"button\" class=\"template-color close-modal close-modal-btn text-center ml-2 rounded-8 btn-border\n        epilogue-semibold\" onclick=\"closeZeroFilterModal();\">Close\n            <\/button>\n        <\/div>\n    <\/div>\n<\/div>\n<!-- second modal -->\n\n<!--  -->\n\n<div id=\"result-div\">\n\n    <ul id=\"list-result\" class=\"users-list list\\\n    \">\n\n        <div class=\"nav-pagination\">\n\n            <ul class=\"pagination\"><\/ul>\n\n\n        <\/div>\n\n\n    <\/ul>\n\n    <div class=\"nav-pagination\">\n\n        <ul class=\"pagination\"><\/ul>\n\n\n    <\/div>\n\n\n<\/div>\n\n<!--<h1><\/h1>-->\n\n<div id=\"empty-block\" class=\"bg-white border rounded-4\" style=\"padding-top:120px\">\n    <img src=\"#appResource.hiring.png#\" alt=\"hirevioo search\" style=\"width: 300px; height: 300px;\">\n    <h4 class=\"epilogue-medium\" style=\"margin-top: 25px;color:\n        #614ac1;\">Please enter a search keyword<\/h4>\n<\/div>\n\n\n<script>\n    $(document).keypress(\n        function (event) {\n\n            if (event.which == '13') {\n\n                event.preventDefault();\n\n                var sc = $(\"save_title_advancedSearch\").val();\n                var keywrodsValue = $(\"#keywords\").val();\n                if (sc != '') {\n                    $(\"#confirmSaveSearch\").click();\n                } else if (keywrodsValue != '') {\n                    $(\"#submit\").click();\n                }\n\n            }\n        });\n\n    // function redirect on submit to saved search form\n\n\n    function popup_show(oid, id_search) {\n        var popup = new PopupDialog(\"firm_preview?id=\" + oid + \"&search=\" + id_search + \"&saved=false\" + \"&title=New search&embed=true\", \"\");\n        popup.parentWindow = window;\n        popup.init();\n    }\n\n\n    const result = document.getElementById('list-result');\n\n    const total = document.getElementById('total');\n    const listItems = [];\n    let arrayProfiles = [];\n\n    function insertGlobal(value) {\n        fetch('#envVariable.backend_hirevioo_url_api#/insertAllProfiles', {\n                method: 'POST',\n                body: JSON.stringify({\n                    val: value\n                }),\n                headers: {\n                    'Content-type': 'application/json; charset=UTF-8',\n                }\n            })\n            .then(res => res.json())\n            .then(data => {\n                //console.log(\"data inserted\");\n            })\n            .catch(error => {\n                //console.log(error)\n            });\n\n\n    }\n\n\n    function getData(search_result, id_search) {\n        document.getElementById('empty-block').style.display = \"none\";\n\n\n        const data = search_result;\n        const jsonData = JSON.parse(data);\n        var totalResult = jsonData.nb_results;\n        const lengthResult = jsonData.nb_results;\n        console.log(jsonData);\n        if (totalResult > 0) {\n            document.getElementById('SaveAdvs').disabled = false;\n        }\n        document.getElementById(\"total_result\").innerHTML = totalResult;\n\n\n        document.getElementById(\"saved_firms\").value = totalResult;\n        // clear\n        result.innerHTML = '';\n\n        jsonData.results.forEach(function (firm, index, array) {\n\n            const li = document.createElement('li');\n            // store for filter\n            listItems.push(li);\n            var tags = \"\";\n\n            if (firm.specialities != \"\" && firm.specialities != null) {\n                firm.specialities.forEach(value => {\n                    tags += `<p class=\"tag\">${value}<\/p>`\n\n                });\n            }\n\n            //var oid = firm._source.doc_id.$oid;\n            var oid = firm.id;\n            var image = firm.image != \"\" ? `${firm.image}` : \"#appResource.StartupDefault.jpg#\";\n\n\n            li.innerHTML = `\n\n            <input id=\"${firm.id}\" type=\"checkbox\" class=\"firms\" value=\"${firm.id}\"/>\n             \n                <a onclick=\"popup_show('` + oid + `','` + id_search + `');return false;\" >\n                     <div id=\"${firm.id}\" class=\"d-md-flex  flex-grow-1 align-items-center justify-content-between p-3 mb-2 bg-white border  position-relative talent-advenced-search rounded-8\">\n                      <div class=\"d-sm-flex w-100\">\n                      \n                      <img class=\"me-4\" src=\"${image}\" alt=\"${firm.name}\">\n                        <div class=\"talent-body d-flex flex-column justify-content-between align-items-center align-items-sm-start\">\n                          <div class=\"talent-name epilogue-semiBold\">\n                          \n                            <h4 class=\"color-black my-3 epilogue-semiBold\" id=\"firmname_result\">${firm.name}<\/h4>\n                           \n                          <\/div>\n       \n                          <div class=\"talent-job \">\n                            <h5>\n                              <span class=\"epilogue-semiBold\">${firm.company_size_label}\n                            <\/h5>\n                          <\/div>\n             \n                          <div class=\"skills mt-2\" style=\" min-height: 34px;\">\n                          <div  class=\" mx-1 px-3 py-1 float-start rounded-2  fs-6 epilogue-bold mb-1\">${tags}<\/div>\n                          <\/div>\n                        <\/div>\n                      <\/div>\n                        <i class=\"fa fa-heart-o template-color  fs-2 float-end position-absolute\" style=\"right: 15px;top: 15px;\"><\/i>\n                     <\/div>\n                    <\/a>`;\n\n            result.appendChild(li);\n            if (lengthResult > 1 && index <= lengthResult - 1) {\n                var nextProfile = \"\";\n                var previousProfile = \"\";\n                var nextProfileId = \"\";\n                var previousProfileId = \"\";\n                if (index == 0) {\n                    nextProfile = array[index + 1];\n                    nextProfileId = nextProfile.id;\n                    previousProfileId = oid;\n                } else if (index == lengthResult - 1) {\n                    previousProfile = array[index - 1];\n                    nextProfileId = oid;\n                    previousProfileId = previousProfile.id;\n                } else {\n                    nextProfile = array[index + 1];\n                    previousProfile = array[index - 1];\n                    nextProfileId = nextProfile.id;\n                    previousProfileId = previousProfile.id;\n                }\n            } else {\n                nextProfileId = oid;\n                previousProfileId = oid;\n            }\n            //////////////////\n            var object = `(\"${id_search}\",\"${oid}\",0,False,\"${nextProfileId}\",\"${previousProfileId}\")`;\n            arrayProfiles.push(object);\n        });\n        insertGlobal(arrayProfiles);\n    }\n\n    function ModalCallOut(x) {\n\n        // Get the modal\n        var modalFilters = document.getElementById(\"myModal-Error\");\n        var modalmessage = modalFilters.getElementsByClassName('color-blue-1 p-2 text-center w-100 epilogue-semiBold')[0].innerHTML = x;\n\n        // Get the <span> element that closes the modal\n        var spanFilter = document.getElementsByClassName(\"close-modal\")[2];\n\n\n        // When the user clicks on <span> (x), close the modal\n        spanFilter.onclick = function () {\n            modalFilters.style.display = \"none\";\n        }\n\n\n        modalFilters.style.display = \"block\";\n        apiResult.value = '';\n        window.addEventListener(\"click\", function (e) {\n            if (e.target == modalFilters) {\n                modalFilters.style.display = \"none\";\n                //  window.location.href = '5704E3A4FC224543A4E84D24A2B1DD96';\n            }\n        });\n    }\n\n    function closeZeroFilterModal() {\n        var spanFilter = document.getElementsByClassName(\"close-modal\")[2];\n        spanFilter.click();\n        window.location.href = 'firms';\n    }\n\n    function sort_by_key(array, key) {\n        console.log(array);\n        return array.sort(function (a, b) {\n            var x = a[key];\n            var y = b[key];\n            return ((x < y) ? -1 : ((x > y) ? 1 : 0));\n        });\n    }\n\n    function LastFirstButtons(list) {\n        $('.nav-pagination').append('<div class=\"btn-next\"> <i class=\"fa fa-angle-right\" style=\"font-size:14px\"><\/i> <\/div><div class=\"btn-last\"> <i class=\"fa fa-angle-double-right\" style=\"font-size:14px;\"><\/i> <\/div>');\n        $('.nav-pagination').prepend('<div class=\"btn-first\"> <i class=\"fa fa-angle-double-left\" style=\"font-size:14px;\"><\/i> <\/div><div class=\"btn-prev\"> <i class=\"fa fa-angle-left\" style=\"font-size:14px;\"><\/i> <\/div>');\n\n        $('.btn-next').on('click', function () {\n            $('.pagination .active').next().trigger('click');\n        })\n        $('.btn-prev').on('click', function () {\n            $('.pagination .active').prev().trigger('click');\n        })\n        $('.btn-first').on('click', function () {\n            list.show(1, 6)\n        })\n        $('.btn-last').on('click', function () {\n            list.show(list.size() - 5, 6)\n        })\n    }\n\n    $(document).ready(function () {\n        sessionStorage.setItem(\"pageNav\", \"firm_search_nav\");\n        setActiveClassToSideMenu();\n        apiResult = document.getElementById('result').value;\n        const queryString = window.location.search;\n        const urlParams = new URLSearchParams(queryString);\n        const id_search = urlParams.get('id');\n        if (apiResult != \"\") {\n            if (apiResult.includes('filtersMandatory')) {\n                var x = '#envVariable.AdvancedSearch400Status#';\n                ModalCallOut(x);\n\n            } else if (apiResult.includes('serverError')) {\n                // #envVariable.AdvancedSearch400Status#\n                var x = '#envVariable.AdvancedSearch500Status#';\n                ModalCallOut(x);\n            } else if (apiResult.includes('\"nb_results\":0')) {\n                var x = '#envVariable.AdvancedSearch0Result#';\n                ModalCallOut(x);\n            } else {\n                document.getElementById(\"empty-block\").style.display = \"none\";\n                const queryString = window.location.search;\n                const urlParams = new URLSearchParams(queryString);\n                const id_search = urlParams.get('id');\n                getData(apiResult, id_search);\n                var paginationList = new List('result-div', {\n                    page: 6,\n                    pagination: true\n                });\n                LastFirstButtons(paginationList)\n            }\n\n            document.getElementById('sortOption').addEventListener(\"change\", function () {\n                var apiResult = document.getElementById('result').value;\n                var option = document.getElementById('sortOption').value;\n                const jsonSearchResultData = JSON.parse(apiResult);\n                if (option == 'locationAZ') {\n                    var sortedArray = sort_by_key(jsonSearchResultData.results, 'name');\n                    // console.log(sortedArray);\n                    var sortedRes = '{\"results\":' + JSON.stringify(sortedArray) + ',\"nb_results\":' + jsonSearchResultData.nb_results + \"}\";\n                    getData(sortedRes, id_search);\n                    // var paginationList = new List('result-div', {\n                    //         page: 6,\n                    //         pagination: true\n                    //     });\n                    //     LastFirstButtons(paginationList)\n\n                } else {\n                    getData(apiResult, id_search);\n                    // var paginationList = new List('result-div', {\n                    //         page: 6,\n                    //         pagination: true\n                    //     });\n                    //     LastFirstButtons(paginationList)\n\n                }\n            });\n        }});\n$(document).ready(function () {\nvar selections = [];\nvar checkboxElems = $('.firms');\nvar btn = document.getElementById('save_value');\nconsole.log(checkboxElems);\n\nfor (var i = 0; i < checkboxElems.length; i++) {\n  checkboxElems[i].addEventListener(\"click\", getSelectedFirms);\n}\n\nfunction getSelectedFirms(e) {\n   var idSelected = this.getAttribute(\"id\");\n  if (e.target.checked) {\n    \n      selections.push(e.target.value);\n      \n      console.log(\"id \"+idSelected)\n\n  } \n  else {\n    selections.splice(selections.indexOf(e.target.value), 1);\n  }\n\n    if(selections.length==0){\n        btn.disabled = true;\n    }\n    else{\n        btn.disabled = false;\n    }\n    console.log(selections);\n}\n\n});\n    \n<\/script>"
                        }
                    }
                ],
                "properties": {"width": "100%"}
            }],
            "properties": {
                "comment": "",
                "id": "section2",
                "join": "",
                "label": "",
                "loadBinder": {
                    "className": "",
                    "properties": {}
                },
                "permission": {
                    "className": "",
                    "properties": {}
                },
                "permissionReadonly": "",
                "readonly": "",
                "readonlyLabel": "",
                "regex": "",
                "reverse": "",
                "storeBinder": {
                    "className": "",
                    "properties": {}
                },
                "visibilityControl": "",
                "visibilityValue": ""
            }
        }
    ],
    "properties": {
        "description": "",
        "id": "advaced_search_firms",
        "loadBinder": {
            "className": "org.joget.apps.form.lib.WorkflowFormBinder",
            "properties": {}
        },
        "name": "Advanced Firms search",
        "noPermissionMessage": "",
        "permission": {
            "className": "",
            "properties": {}
        },
        "postProcessor": {
            "className": "org.joget.apps.app.lib.BeanShellTool",
            "properties": {"script": "import org.joget.apps.form.model.*;\r\nimport org.joget.apps.form.service.*;\r\nimport org.joget.apps.app.service.*;\r\nimport java.sql.*;\r\nimport java.util.*;\r\nimport java.text.*;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport java.sql.Date;\r\n\r\n    String recordId = \"#form.app_fd_adv_search_firms.id#\";\r\n     System.out.println(\"==============================>\"+recordId);\r\n    DateFormat dateFormat = new SimpleDateFormat(\"yyyy-MM-dd\");\r\n    java.util.Date date = new java.util.Date();\r\n    String dateSave=dateFormat.format(date);\r\n    System.out.println(\"==============================>\"+dateSave);\r\n    //Get Joget's current datasource configs\r\n    DataSource ds = (DataSource) AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n    con = ds.getConnection();\r\n    if (!con.isClosed()) {\r\n\r\n            //Here you can query from one or multiple tables using JOIN etc\r\n           String sql = \"UPDATE app_fd_adv_search_firms SET c_date=? WHERE id=?;\";\r\n    \r\n            PreparedStatement stmt = con.prepareStatement(sql);\r\n            \r\n            stmt.setString(1, dateSave);\r\n            stmt.setString(2, recordId);\r\n            //Execute the SELECT SQL statement\r\n            ////Execute SQL statement\r\n            stmt.executeUpdate();\r\n     \r\n    }\r\n    con.close();\r\n"}
        },
        "postProcessorRunOn": "both",
        "storeBinder": {
            "className": "org.joget.apps.form.lib.BeanShellFormBinder",
            "properties": {
                "autoHandleFiles": "",
                "autoHandleWorkflowVariable": "true",
                "cacheInterval": "",
                "script": "import org.joget.apps.form.model.FormRowSet;\r\nimport org.joget.apps.form.model.FormRow;\r\nimport org.bson.Document;\r\nimport java.sql.Connection;\r\nimport java.sql.PreparedStatement;\r\nimport java.sql.ResultSet;\r\nimport java.sql.SQLException;\r\nimport javax.sql.DataSource;\r\nimport org.joget.commons.util.LogUtil;\r\nimport org.joget.apps.app.service.AppUtil;\r\nimport org.joget.commons.util.UuidGenerator;\r\nimport org.joget.apps.form.model.FormStoreBinder;\r\nimport org.joget.plugin.base.PluginManager;\r\nimport org.joget.apps.form.model.Element;\r\nimport org.joget.apps.form.model.FormData;\r\nimport org.joget.commons.util.LogUtil;\r\nimport org.bson.Document;\r\n\r\nimport org.apache.http.HttpResponse;\r\nimport org.apache.http.client.methods.HttpGet;\r\nimport org.apache.http.client.methods.HttpRequestBase;\r\nimport org.apache.http.impl.client.CloseableHttpClient;\r\nimport org.apache.http.impl.client.HttpClients;\r\nimport org.apache.http.HttpEntity;\r\nimport org.apache.http.util.EntityUtils;\r\nimport java.io.IOException;\r\nimport java.nio.charset.StandardCharsets;\r\nimport java.net.URLEncoder;\r\n\r\npublic void deleteOldRows(){\r\n    String id_search=\"#requestParam.id#\";\r\n    //Get Joget's current datasource configs\r\n    DataSource ds = (DataSource) AppUtil.getApplicationContext().getBean(\"setupDataSource\");\r\n     \r\n    con = ds.getConnection();\r\n     \r\n    if (!con.isClosed()) {\r\n      \r\n        //Here you can query from one or multiple tables using JOIN etc\r\n        String sql = \"Delete FROM app_fd_recherche_inter WHERE id_recherche='\"+id_search+\"'\";\r\n        PreparedStatement stmt = con.prepareStatement(sql);\r\n\r\n        //Execute the Delete SQL statement\r\n        stmt.executeUpdate();\r\n        \r\n        con.close();\r\n    }\r\n    \r\n}\r\n\r\npublic String setTags(){\r\n    String tags=\"\";\r\n    String keywords=\"\";\r\n    String industry=\"\";\r\n    String location=\"\";\r\n    String speciality=\"\";\r\n\r\n    if(!rows.get(0).getProperty(\"keywords\").equals(\"\"))\r\n    {\r\n        keywords=rows.get(0).getProperty(\"keywords\");\r\n        \r\n        if(tags.equals(\"\"))\r\n            tags=\"keywords: \"+keywords;\r\n        else\r\n            tags+=\", keywords: \"+keywords;\r\n      \r\n    }\r\n    if(!rows.get(0).getProperty(\"industry\").equals(\"\"))\r\n    {\r\n      industry=rows.get(0).getProperty(\"industry\");\r\n      industry=industry.toLowerCase();\r\n\r\n      if(tags.equals(\"\"))\r\n            tags=\"industry: \"+industry;\r\n        else\r\n            tags+=\", industry: \"+industry;\r\n    }\r\n    \r\n    if(!rows.get(0).getProperty(\"location\").equals(\"\"))\r\n    {\r\n        if(rows.get(0).getProperty(\"location\").contains(\";\")){\r\n            location=rows.get(0).getProperty(\"location\").replaceAll(\";\",\" \");\r\n        }\r\n        else{\r\n            location=rows.get(0).getProperty(\"location\");\r\n        }\r\n        location=location.toLowerCase();\r\n        if(tags.equals(\"\"))\r\n            tags=\"location: \"+location;\r\n        else\r\n            tags+=\", location: \"+location;\r\n    }\r\n    if(!rows.get(0).getProperty(\"speciality\").equals(\"\"))\r\n    {\r\n        if(rows.get(0).getProperty(\"speciality\").contains(\";\")){\r\n            speciality=rows.get(0).getProperty(\"speciality\").replaceAll(\";\",\" \");\r\n        }\r\n        else{\r\n            speciality=rows.get(0).getProperty(\"speciality\");\r\n        }\r\n            \r\n        speciality=speciality.toLowerCase();\r\n        if(tags.equals(\"\"))\r\n            tags=\"speciality: \"+speciality;\r\n        else\r\n            tags+=\", speciality: \"+speciality;\r\n    }\r\n    \r\n\r\n    return tags;\r\n}\r\n\r\n// consume API\r\npublic String searchAPI(){\r\n    \r\n    String keywords=\"\";\r\n    String industry=\"\";\r\n    String location=\"\";\r\n    String actively_hiring=\"\";\r\n    String speciality=\"\";\r\n    String min_years_of_exp=\"\";\r\n    String max_years_of_exp=\"\";\r\n\r\n    if(!rows.get(0).getProperty(\"keywords\").equals(\"\"))\r\n    {\r\n        keywords=rows.get(0).getProperty(\"keywords\");\r\n      \r\n    }\r\n    if(!rows.get(0).getProperty(\"industry\").equals(\"\"))\r\n    {\r\n      industry=rows.get(0).getProperty(\"industry\");\r\n      industry=industry.toLowerCase();\r\n    }\r\n\r\n    if(!rows.get(0).getProperty(\"actively_hiring\").equals(\"\"))\r\n    {\r\n        actively_hiring=rows.get(0).getProperty(\"actively_hiring\");\r\n      \r\n    }\r\n    \r\n    if(!rows.get(0).getProperty(\"location\").equals(\"\"))\r\n    {\r\n        String locationTags=\"\";\r\n        if(rows.get(0).getProperty(\"location\").contains(\";\")){\r\n            location=rows.get(0).getProperty(\"location\").replaceAll(\";\",\" \");\r\n            locationTags=rows.get(0).getProperty(\"location\").replaceAll(\";\",\",\");\r\n        }\r\n        else{\r\n            location=rows.get(0).getProperty(\"location\");\r\n            locationTags=rows.get(0).getProperty(\"location\");\r\n        }\r\n\r\n        location=location.toLowerCase();\r\n    }\r\n    if(!rows.get(0).getProperty(\"speciality\").equals(\"\"))\r\n    {\r\n        String specialityTags=\"\";\r\n        if(rows.get(0).getProperty(\"speciality\").contains(\";\")){\r\n            speciality=rows.get(0).getProperty(\"speciality\").replaceAll(\";\",\" \");\r\n            specialityTags=rows.get(0).getProperty(\"speciality\").replaceAll(\";\",\",\");\r\n        }\r\n        else{\r\n            speciality=rows.get(0).getProperty(\"speciality\");\r\n            specialityTags=rows.get(0).getProperty(\"speciality\");\r\n        }\r\n            \r\n        speciality=speciality.toLowerCase();\r\n    }\r\n    \r\n    min_years_of_exp=rows.get(0).getProperty(\"min_num_of_emp\");\r\n    max_years_of_exp=rows.get(0).getProperty(\"max_num_of_emp\");\r\n    \r\n    \r\n    try{\r\n        // String jsonUrl = \"#envVariable.elasticsearch_hirevioo_url_api#/search/companies/companies?keywords=\"+URLEncoder.encode(keywords, StandardCharsets.UTF_8)\r\n        // +\"&industry=\"+URLEncoder.encode(industry, StandardCharsets.UTF_8)\r\n        // +\"&locations=\"+URLEncoder.encode(location, StandardCharsets.UTF_8)\r\n        // +\"&specialties=\"+URLEncoder.encode(speciality, StandardCharsets.UTF_8)\r\n        // +\"&size_min=\"+URLEncoder.encode(min_years_of_exp, StandardCharsets.UTF_8)\r\n        // +\"&size_max=\"+URLEncoder.encode(max_years_of_exp, StandardCharsets.UTF_8);\r\n        String jsonUrl = \"http://127.0.0.1:8002/companies/\"+URLEncoder.encode(keywords, StandardCharsets.UTF_8).replaceAll(\"\\\\+\", \"%20\");\r\n\r\n        LogUtil.info(jsonUrl,\"\");\r\n        \r\n        CloseableHttpClient client = null;\r\n        CloseableHttpClient client = HttpClients.createDefault();\r\n     \r\n        HttpRequestBase request = null;\r\n        request = new HttpGet(jsonUrl);\r\n    \r\n        HttpResponse response = client.execute(request);\r\n        int statusCode = response.getStatusLine().getStatusCode();\r\n        if(statusCode==200){\r\n        HttpEntity entity = response.getEntity();\r\n        // Read the contents of an entity and return it as a String.\r\n        String res = EntityUtils.toString(entity,StandardCharsets.UTF_8);\r\n        request.releaseConnection();\r\n        client.close();\r\n        return res;\r\n        }\r\n        else if(statusCode==400){\r\n            return \"filtersMandatory\";\r\n        }else{\r\n            return \"serverError\";\r\n      \r\n        }\r\n     \r\n    } catch (Exception ex) {\r\n            System.out.println(ex);\r\n    }\r\n    return \"\";\r\n}\r\n\r\n\r\n\r\npublic FormRowSet store(Element element, FormRowSet rows, FormData formData) {\r\n     String tags=\"\";\r\n    //check the rows is not empty before store it\r\n    if (rows != null && !rows.isEmpty()) {\r\n        //Get the submitted data\r\n        FormRow row = rows.get(0);\r\n        \r\n        if(!\"#requestParam.id#\".equals(\"\")){\r\n            deleteOldRows();\r\n        }\r\n        \r\n        String searchResult=searchAPI();\r\n        row.setProperty(\"result\", searchResult);\r\n        if(searchResult.contains(\"nb_results\")){\r\n            Document doc= Document.parse(searchResult);\r\n            row.setProperty(\"saved_firms\", Integer.toString(doc.getInteger(\"nb_results\")));\r\n        }\r\n        tags=setTags();\r\n        row.setProperty(\"tags\", tags);\r\n        // LogUtil.info(\"-------------------------------------------------------->Tags: \"+searchResult,\"\");\r\n        //Reuse Workflow Form Binder to store data\r\n        PluginManager pluginManager = (PluginManager) AppUtil.getApplicationContext().getBean(\"pluginManager\");\r\n        FormStoreBinder binder = (FormStoreBinder) pluginManager.getPlugin(\"org.joget.apps.form.lib.WorkflowFormBinder\");\r\n        binder.store(element, rows, formData);\r\n    }\r\n     \r\n    return rows;\r\n}\r\n \r\n//call store method with injected variable\r\nreturn store(element, rows, formData);\r\n"
            }
        },
        "tableName": "adv_search_firms"
    }
}